<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Configuration | Apache Gluten incubating</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="Configuration" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Gluten is a middle layer responsible for offloading JVM-based SQL engines’ execution to native engines." /> <meta property="og:description" content="Gluten is a middle layer responsible for offloading JVM-based SQL engines’ execution to native engines." /> <link rel="canonical" href="https://gluten.apache.org/docs/configuration/" /> <meta property="og:url" content="https://gluten.apache.org/docs/configuration/" /> <meta property="og:site_name" content="Apache Gluten incubating" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Configuration" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Gluten is a middle layer responsible for offloading JVM-based SQL engines’ execution to native engines.","headline":"Configuration","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://gluten.apache.org/assets/images/gluten-logo-blue.png"}},"url":"https://gluten.apache.org/docs/configuration/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Apache Gluten incubating"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Documentations category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/" class="nav-list-link">Documentations</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting-Started category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/getting-started/" class="nav-list-link">Getting-Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/getting-started/velox-backend/" class="nav-list-link">Getting Start with Velox Backend</a></li><li class="nav-list-item"><a href="/docs/getting-started/clickhouse-backend/" class="nav-list-link">Getting start with ClickHouse Backend</a></li><li class="nav-list-item"><a href="/docs/getting-started/build-guide/" class="nav-list-link">Build Parameters for Velox Backend</a></li><li class="nav-list-item"><a href="/docs/getting-started/s3/" class="nav-list-link">Using S3 with Gluten</a></li><li class="nav-list-item"><a href="/docs/getting-started/gcs/" class="nav-list-link">Using GCS with Gluten</a></li><li class="nav-list-item"><a href="/docs/getting-started/abfs/" class="nav-list-link">Using ABFS with Gluten</a></li><li class="nav-list-item"><a href="/docs/getting-started/localcache/" class="nav-list-link">Velox Local Caching</a></li></ul></li><li class="nav-list-item"><a href="/docs/configuration/" class="nav-list-link">Configuration</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Developers category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/developers/" class="nav-list-link">Developers</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/developers/how-to-use/" class="nav-list-link">How To Use Gluten</a></li><li class="nav-list-item"><a href="/docs/developers/new-to/" class="nav-list-link">New To Gluten</a></li><li class="nav-list-item"><a href="/docs/developers/microbenchmarks/" class="nav-list-link">Micro Benchmarks for Velox Backend</a></li><li class="nav-list-item"><a href="/docs/developers/cpp-code-style/" class="nav-list-link">CPP Code Style</a></li><li class="nav-list-item"><a href="/docs/developers/velox-function-dev/" class="nav-list-link">Velox Function Development</a></li><li class="nav-list-item"><a href="/docs/developers/docker-ubuntu/" class="nav-list-link">Docker script for Ubuntu 22.04/20.04</a></li><li class="nav-list-item"><a href="/docs/developers/docker-centos7/" class="nav-list-link">Docker script for CentOS 7</a></li><li class="nav-list-item"><a href="/docs/developers/docker-centos8/" class="nav-list-link">Docker script for CentOS 8</a></li><li class="nav-list-item"><a href="/docs/developers/substrait/" class="nav-list-link">Substrait Modifications</a></li><li class="nav-list-item"><a href="/docs/developers/how-to-release/" class="nav-list-link">How To Release</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Velox Backend category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/velox-backend/" class="nav-list-link">Velox Backend</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/velox-backend/support/" class="nav-list-link">Supported Operators & Functions</a></li><li class="nav-list-item"><a href="/docs/velox-backend/limitations/" class="nav-list-link">Limitations</a></li><li class="nav-list-item"><a href="/docs/velox-backend/troubleshooting/" class="nav-list-link">Troubleshooting</a></li><li class="nav-list-item"><a href="/docs/velox-backend/udf/" class="nav-list-link">Velox UDF</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Archives category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/archives/" class="nav-list-link">Archives</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in v1.1.1 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/archives/v1.1.1/" class="nav-list-link">v1.1.1</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in v1.1.1/Documentation category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/archives/v1.1.1/docs/" class="nav-list-link">v1.1.1/Documentation</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in v1.1.1/Velox Backend category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/archives/v1.1.1/docs/velox/" class="nav-list-link">v1.1.1/Velox Backend</a><ul class="nav-list"><li class="nav-list-item"><a href="/archives/v1.1.1/docs/velox/getting-started/" class="nav-list-link">v1.1.1/Getting-Started with Velox Backend</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/docs/velox/build_parameters/" class="nav-list-link">v1.1.1/Build Parameters for Velox Backend</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/docs/velox/s3/" class="nav-list-link">v1.1.1/Using S3 with Gluten</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/docs/velox/gcs/" class="nav-list-link">v1.1.1/Using GCS with Gluten</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in v1.1.1/ClickHouse Backend category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/archives/v1.1.1/docs/clickhouse/" class="nav-list-link">v1.1.1/ClickHouse Backend</a><ul class="nav-list"><li class="nav-list-item"><a href="/archives/v1.1.1/docs/clickhouse/getting-started/" class="nav-list-link">v1.1.1/Getting Started with ClickHouse Backend</a></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in v1.1.1/Developers category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/archives/v1.1.1/developers/" class="nav-list-link">v1.1.1/Developers</a><ul class="nav-list"><li class="nav-list-item"><a href="/archives/v1.1.1/developers/newto/" class="nav-list-link">v1.1.1/New To Gluten</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/howto/" class="nav-list-link">v1.1.1/How To Use Gluten</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/microbenchmark/" class="nav-list-link">v1.1.1/Micro Benchmarks for Velox Backend</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/cpp_code_style/" class="nav-list-link">v1.1.1/CPP Code Style</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/velox_function_development/" class="nav-list-link">v1.1.1/Velox Function Development</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/docker_ubuntu/" class="nav-list-link">v1.1.1/Docker script for Ubuntu 22.04/20.04</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/docker_centos8" class="nav-list-link">v1.1.1/Docker script for CentOS 8</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/docker_centos7/" class="nav-list-link">v1.1.1/Docker script for CentOS 7</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/substrait/" class="nav-list-link">v1.1.1/Substrait Modifications</a></li><li class="nav-list-item"><a href="/archives/v1.1.1/developers/howtorelease/" class="nav-list-link">v1.1.1/How To Release</a></li></ul></li></ul></li></ul></li><li class="nav-list-item"><a href="/downloads/" class="nav-list-link">Downloads</a></li><li class="nav-list-item"><a href="/references/" class="nav-list-link">Gluten References</a></li><li class="nav-list-item"><a href="/contributing/" class="nav-list-link">Contributing to Gluten</a></li><li class="nav-list-item"><a href="/contact/" class="nav-list-link">Contact Us</a></li><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Apache Gluten incubating" aria-label="Search Apache Gluten incubating" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <style> /* Style The Dropdown Button */ .dropbtn { background-color: #0000ff80; color: white; padding: 22px; width: 100%; font-size: 14px; border: none; cursor: pointer; } /* The container <div> - needed to position the dropdown content */ .dropdown { position: relative; display: inline-block; } /* Dropdown Content (Hidden by Default) */ .dropdown-content { display: none; position: absolute; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; } /* Links inside the dropdown */ .dropdown-content a { color: black; padding: 12px 14px; text-decoration: none; display: block; } /* Change color of dropdown links on hover */ .dropdown-content a:hover {background-color: #f1f1f1} /* Show the dropdown menu on hover */ .dropdown:hover .dropdown-content { display: block; } /* Change the background color of the dropdown button when the dropdown content is shown */ .dropdown:hover .dropbtn { background-color: #0000ff; } </style> <!-- Collect the nav links, forms, and other content for toggling --> <div class="dropdown" id="apache-navbar" style="float:left;"> <button class="dropbtn">ASF</button> <div class="dropdown-content"> <a class="dropdown-item" href="https://www.apache.org/">Foundation</a> <a class="dropdown-item" href="https://www.apache.org/events/current-event.html">Event</a> <a class="dropdown-item" href="https://www.apache.org/licenses/">License</a> <a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a> <a class="dropdown-item" href="https://www.apache.org/security/">Security</a> <a class="dropdown-item" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy</a> <a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a> </div> </div><!-- /.navbar-collapse --> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/apache/incubator-gluten" class="site-button" target="_blank" rel="noopener noreferrer" > Apache Gluten Github </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/">Documentations</a></li> <li class="breadcrumb-nav-list-item"><span>Configuration</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="spark-configurations-for-gluten-plugin"> <a href="#spark-configurations-for-gluten-plugin" class="anchor-heading" aria-labelledby="spark-configurations-for-gluten-plugin"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Spark Configurations for Gluten Plugin </h1> <p>There are many configurations could impact the Gluten Plugin performance and can be fine-tuned in Spark. You can add these configurations into spark-defaults.conf to enable or disable the setting.</p> <h2 id="spark-parameters"> <a href="#spark-parameters" class="anchor-heading" aria-labelledby="spark-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Spark parameters </h2> <div class="table-wrapper"><table> <thead> <tr> <th>Parameters</th> <th>Description</th> <th>Recommend Setting</th> </tr> </thead> <tbody> <tr> <td>spark.driver.extraClassPath</td> <td>To add Gluten Plugin jar file in Spark Driver</td> <td>/path/to/jar_file</td> </tr> <tr> <td>spark.executor.extraClassPath</td> <td>To add Gluten Plugin jar file in Spark Executor</td> <td>/path/to/jar_file</td> </tr> <tr> <td>spark.executor.memory</td> <td>To set up how much memory to be used for Spark Executor.</td> <td> </td> </tr> <tr> <td>spark.memory.offHeap.size</td> <td>To set up how much memory to be used for Java OffHeap.<br /> Please notice Gluten Plugin will leverage this setting to allocate memory space for native usage even offHeap is disabled. <br /> The value is based on your system and it is recommended to set it larger if you are facing Out of Memory issue in Gluten Plugin</td> <td>30G</td> </tr> <tr> <td>spark.sql.sources.useV1SourceList</td> <td>Choose to use V1 source</td> <td>avro</td> </tr> <tr> <td>spark.sql.join.preferSortMergeJoin</td> <td>To turn off preferSortMergeJoin in Spark</td> <td>false</td> </tr> <tr> <td>spark.plugins</td> <td>To load Gluten’s components by Spark’s plug-in loader</td> <td>org.apache.gluten.GlutenPlugin</td> </tr> <tr> <td>spark.shuffle.manager</td> <td>To turn on Gluten Columnar Shuffle Plugin</td> <td>org.apache.spark.shuffle.sort.ColumnarShuffleManager</td> </tr> <tr> <td>spark.gluten.enabled</td> <td>Enable Gluten, default is true. Just an experimental property. Recommend to enable/disable Gluten through the setting for <code class="language-plaintext highlighter-rouge">spark.plugins</code>.</td> <td>true</td> </tr> <tr> <td>spark.gluten.memory.isolation</td> <td>(Experimental) Enable isolated memory mode. If true, Gluten controls the maximum off-heap memory can be used by each task to X, X = executor memory / max task slots. It’s recommended to set true if Gluten serves concurrent queries within a single session, since not all memory Gluten allocated is guaranteed to be spillable. In the case, the feature should be enabled to avoid OOM. Note when true, setting spark.memory.storageFraction to a lower value is suggested since storage memory is considered non-usable by Gluten.</td> <td>false</td> </tr> <tr> <td>spark.gluten.ras.enabled</td> <td>Experimental: Enables RAS (relation algebra selector) during physical planning to generate more efficient query plan. Note, this feature is still in development and may not bring performance profits.</td> <td>false</td> </tr> <tr> <td>spark.gluten.sql.columnar.maxBatchSize</td> <td>Number of rows to be processed in each batch. Default value is 4096.</td> <td>4096</td> </tr> <tr> <td>spark.gluten.sql.columnar.scanOnly</td> <td>When enabled, this config will overwrite all other operators’ enabling, and only Scan and Filter pushdown will be offloaded to native.</td> <td>false</td> </tr> <tr> <td>spark.gluten.sql.columnar.batchscan</td> <td>Enable or Disable Columnar BatchScan, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.hashagg</td> <td>Enable or Disable Columnar Hash Aggregate, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.project</td> <td>Enable or Disable Columnar Project, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.filter</td> <td>Enable or Disable Columnar Filter, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.sort</td> <td>Enable or Disable Columnar Sort, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.window</td> <td>Enable or Disable Columnar Window, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffledHashJoin</td> <td>Enable or Disable ShuffledHashJoin, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.forceShuffledHashJoin</td> <td>Force to use ShuffledHashJoin over SortMergeJoin, default is true. For queries that can benefit from storaged patitioned join, please set it to false.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.sortMergeJoin</td> <td>Enable or Disable Columnar Sort Merge Join, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.union</td> <td>Enable or Disable Columnar Union, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.expand</td> <td>Enable or Disable Columnar Expand, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.generate</td> <td>Enable or Disable Columnar Generate, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.limit</td> <td>Enable or Disable Columnar Limit, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.tableCache</td> <td>Enable or Disable Columnar Table Cache, default is false</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.broadcastExchange</td> <td>Enable or Disable Columnar Broadcast Exchange, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.broadcastJoin</td> <td>Enable or Disable Columnar BroadcastHashJoin, default is true</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffle.sort.threshold</td> <td>The threshold to determine whether to use sort-based columnar shuffle. Sort-based shuffle will be used if the number of partitions is greater than this threshold.</td> <td>100000</td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffle.codec</td> <td>Set up the codec to be used for Columnar Shuffle. If this configuration is not set, will check the value of spark.io.compression.codec. By default, Gluten use software compression. Valid options for software compression are lz4, zstd. Valid options for QAT and IAA is gzip.</td> <td>lz4</td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffle.codecBackend</td> <td>Enable using hardware accelerators for shuffle de/compression. Valid options are QAT and IAA.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffle.compressionMode</td> <td>Setting different compression mode in shuffle, Valid options are buffer and rowvector, buffer option compress each buffer of RowVector individually into one pre-allocated large buffer, rowvector option first copies each buffer of RowVector to a large buffer and then compress the entire buffer in one go.</td> <td>buffer</td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffle.compression.threshold</td> <td>If number of rows in a batch falls below this threshold, will copy all buffers into one buffer to compress.</td> <td>100</td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffle.realloc.threshold</td> <td>Set the threshold to dynamically adjust the size of shuffle split buffers. The size of each split buffer is recalculated for each incoming batch of data. If the new size deviates from the current partition buffer size by a factor outside the range of [1 - threshold, 1 + threshold], the split buffer will be re-allocated using the newly calculated size</td> <td>0.25</td> </tr> <tr> <td>spark.gluten.sql.columnar.shuffle.merge.threshold</td> <td>Set the threshold control the minimum merged size. When a partition buffer is full, and the number of rows is below (<code class="language-plaintext highlighter-rouge">threshold * spark.gluten.sql.columnar.maxBatchSize</code>), it will be saved for merging.</td> <td>0.25</td> </tr> <tr> <td>spark.gluten.sql.columnar.numaBinding</td> <td>Set up NUMABinding, default is false</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.coreRange</td> <td>Set up the core range for NUMABinding, only works when numaBinding set to true. <br /> The setting is based on the number of cores in your system. Use 72 cores as an example.</td> <td>0-17,36-53 |18-35,54-71</td> </tr> <tr> <td>spark.gluten.sql.columnar.wholeStage.fallback.threshold</td> <td>Configure the threshold for whether whole stage will fall back in AQE supported case by counting the number of ColumnarToRow &amp; vanilla leaf node</td> <td>&gt;= 1</td> </tr> <tr> <td>spark.gluten.sql.columnar.query.fallback.threshold</td> <td>Configure the threshold for whether query will fall back by counting the number of ColumnarToRow &amp; vanilla leaf node</td> <td>&gt;= 1</td> </tr> <tr> <td>spark.gluten.sql.columnar.fallback.ignoreRowToColumnar</td> <td>When true, the fallback policy ignores the RowToColumnar when counting fallback number.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.fallback.preferColumnar</td> <td>When true, the fallback policy prefers to use Gluten plan rather than vanilla Spark plan if the both of them contains ColumnarToRow and the vanilla Spark plan ColumnarToRow number is not smaller than Gluten plan.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.force.hashagg</td> <td>Force to use hash agg to replace sort agg.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.columnar.vanillaReaders</td> <td>Enable vanilla spark’s vectorized reader. Please note it may bring perf. overhead due to extra data transition. We recommend to disable it if most queries can be fully offloaded to gluten.</td> <td>false</td> </tr> <tr> <td>spark.gluten.sql.native.bloomFilter</td> <td>Enable or Disable native runtime bloom filter.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.native.arrow.reader.enabled</td> <td>Enable or Disable native arrow read CSV file format</td> <td>false</td> </tr> <tr> <td>spark.gluten.shuffleWriter.bufferSize</td> <td>Set the number of buffer rows for the shuffle writer</td> <td>value of spark.gluten.sql.columnar.maxBatchSize</td> </tr> <tr> <td>spark.gluten.loadLibFromJar</td> <td>Controls whether to load dynamic link library from a packed jar for gluten/cpp. Not applicable to static build and clickhouse backend.</td> <td>false</td> </tr> <tr> <td>spark.gluten.loadLibOS</td> <td>When <code class="language-plaintext highlighter-rouge">spark.gluten.loadLibFromJar</code> is true. Manually specify the system os to load library, e.g., CentOS</td> <td> </td> </tr> <tr> <td>spark.gluten.loadLibOSVersion</td> <td>Manually specify the system os version to load library, e.g., if <code class="language-plaintext highlighter-rouge">spark.gluten.loadLibOS</code> is CentOS, this config can be 7</td> <td> </td> </tr> <tr> <td>spark.gluten.expression.blacklist</td> <td>A black list of expression to skip transform, multiple values separated by commas.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.fallback.expressions.threshold</td> <td>Fall back filter/project if the height of expression tree reaches this threshold, considering Spark codegen can bring better performance for such case.</td> <td>50</td> </tr> <tr> <td>spark.gluten.sql.cartesianProductTransformerEnabled</td> <td>Config to enable CartesianProductExecTransformer.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.broadcastNestedLoopJoinTransformerEnabled</td> <td>Config to enable BroadcastNestedLoopJoinExecTransformer.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.cacheWholeStageTransformerContext</td> <td>When true, <code class="language-plaintext highlighter-rouge">WholeStageTransformer</code> will cache the <code class="language-plaintext highlighter-rouge">WholeStageTransformerContext</code> when executing. It is used to get substrait plan node and native plan string.</td> <td>false</td> </tr> <tr> <td>spark.gluten.sql.injectNativePlanStringToExplain</td> <td>When true, Gluten will inject native plan tree to explain string inside <code class="language-plaintext highlighter-rouge">WholeStageTransformerContext</code>.</td> <td>false</td> </tr> <tr> <td>spark.gluten.sql.fallbackRegexpExpressions</td> <td>When true, Gluten will fall back all regexp expressions to avoid any incompatibility risk.</td> <td>false</td> </tr> </tbody> </table></div> <h2 id="velox-parameters"> <a href="#velox-parameters" class="anchor-heading" aria-labelledby="velox-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Velox Parameters </h2> <p>The following configurations are related to Velox settings.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Parameters</th> <th>Description</th> <th>Recommend Setting</th> </tr> </thead> <tbody> <tr> <td>spark.gluten.sql.columnar.backend.velox.bloomFilter.expectedNumItems</td> <td>The default number of expected items for the velox bloomfilter.</td> <td>1000000L</td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.bloomFilter.numBits</td> <td>The default number of bits to use for the velox bloom filter.</td> <td>8388608L</td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.bloomFilter.maxNumBits</td> <td>The max number of bits to use for the velox bloom filter.</td> <td>4194304L</td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.fileHandleCacheEnabled</td> <td>Disables caching if false. File handle cache should be disabled if files are mutable, i.e. file content may change while file path stays the same.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.directorySizeGuess</td> <td>Set the directory size guess for velox file scan.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.filePreloadThreshold</td> <td>Set the file preload threshold for velox file scan.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.prefetchRowGroups</td> <td>Set the prefetch row groups for velox file scan.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.loadQuantum</td> <td>Set the load quantum for velox file scan.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.maxCoalescedDistanceBytes</td> <td>Set the max coalesced distance bytes for velox file scan.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.maxCoalescedBytes</td> <td>Set the max coalesced bytes for velox file scan.</td> <td> </td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.cachePrefetchMinPct</td> <td>Set prefetch cache min pct for velox file scan.</td> <td> </td> </tr> <tr> <td>spark.gluten.velox.awsSdkLogLevel</td> <td>Log granularity of AWS C++ SDK in velox.</td> <td>FATAL</td> </tr> <tr> <td>spark.gluten.velox.fs.s3a.retry.mode</td> <td>Retry mode for AWS s3 connection error, can be “legacy”, “standard” and “adaptive”.</td> <td>legacy</td> </tr> <tr> <td>spark.gluten.velox.fs.s3a.connect.timeout</td> <td>Timeout for AWS s3 connection.</td> <td>1s</td> </tr> <tr> <td>spark.gluten.sql.columnar.backend.velox.orc.scan.enabled</td> <td>Enable velox orc scan. If disabled, vanilla spark orc scan will be used.</td> <td>true</td> </tr> <tr> <td>spark.gluten.sql.complexType.scan.fallback.enabled</td> <td>Force fallback for complex type scan, including struct, map, array.</td> <td>true</td> </tr> </tbody> </table></div> <p>Additionally, you can control the configurations of gluten at thread level by local property.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Parameters</th> <th>Description</th> <th>Recommend Setting</th> </tr> </thead> <tbody> <tr> <td>gluten.enabledForCurrentThread</td> <td>Control the usage of gluten at thread level.</td> <td>true</td> </tr> </tbody> </table></div> <p>Below is an example of developing an application using scala to set local properties.</p> <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Before executing the query, set local properties.</span>
<span class="nv">sparkContext</span><span class="o">.</span><span class="py">setLocalProperty</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
<span class="nv">spark</span><span class="o">.</span><span class="py">sql</span><span class="o">(</span><span class="s">"select * from demo_tables"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>
</code></pre></div></div> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <a href="https://incubator.apache.org/"><img src="/assets/images/apache-incubator.svg" style="width:300px"></a> <p class="text-small text-grey-dk-100 mb-0">Copyright © 2024 The Apache Software Foundation, Licensed under the Apache License, Version 2.0. Apache Gluten, Gluten, Apache, the Apache feather logo, and the Apache Gluten project logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.</p> <p class="text-small text-grey-dk-100 mb-0">Apache Gluten is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p> <p class="text-small text-grey-dk-100 mb-0"><a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a></p> <p class="text-small text-grey-dk-100 mb-0">©Intel Corporation. Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries. All other marks mentioned may be trademarks or registered trademarks of their respective owners.</p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
